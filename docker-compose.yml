services:
  mc:
    image: itzg/minecraft-server
    tty: true
    network_mode: host
    environment:
      EULA: "TRUE"
      VERSION: 1.21
      MODE: creative
      OPS: |
        Alpha
        Bravo
      ONLINE_MODE: false
      ENFORCE_SECURE_PROFILE: false
      RCON_PASSWORD: change-me
      # LEVEL_TYPE: "minecraft:single_biome_surface"
      # GENERATOR_SETTINGS: '{"biome":"minecraft:plains"}'
      LEVEL_TYPE: minecraft:flat
      GENERATOR_SETTINGS: >-
        {
          "layers": [
            { "block": "minecraft:bedrock", "height": 1 },
            { "block": "minecraft:stone",   "height": 124 },
            { "block": "minecraft:dirt",    "height": 2 },
            { "block": "minecraft:grass_block", "height": 1 }
          ],
          "biome": "minecraft:plains"
        }
    volumes:
      # attach the relative directory 'data' to the container's /data path
      - ./data34:/data
  senders1:
    build: .
    depends_on:
      - mc
      - receiver1
    network_mode: host
    volumes:
      # attach the relative directory 'data' to the container's /data path
      - ./output3:/output
    environment:
      BOT_NAME: Alpha
      OTHER_BOT_NAME: Bravo
      RECEIVER_PORT: 8091
      COORD_PORT: 8093
      OTHER_COORD_PORT: 8094
      BOT_RNG_SEED: "12345"
      EPISODES_NUM: 10
    command: ./entrypoint_senders.sh
  senders2:
    build: .
    depends_on:
      - mc
      - receiver2
      - senders1
    network_mode: host
    volumes:
      # attach the relative directory 'data' to the container's /data path
      - ./output3:/output
    environment:
      BOT_NAME: Bravo
      OTHER_BOT_NAME: Alpha
      RECEIVER_PORT: 8092
      COORD_PORT: 8094
      OTHER_COORD_PORT: 8093
      BOT_RNG_SEED: "12345"
      EPISODES_NUM: 10
    command: ./entrypoint_senders.sh
  receiver1:
    build: .
    environment:
      PORT: 8091
      NAME: Alpha
    network_mode: host
    tty: true
    volumes:
      # attach the relative directory 'data' to the container's /data path
      - ./output3:/output
    command: ./entrypoint_receiver.sh
  receiver2:
    build: .
    environment:
      PORT: 8092
      NAME: Bravo
    network_mode: host
    tty: true
    volumes:
      # attach the relative directory 'data' to the container's /data path
      - ./output3:/output
    command: ./entrypoint_receiver.sh

  script:
    build: .
    network_mode: host
    tty: true
    volumes:
      # attach the relative directory 'data' to the container's /data path
      - ./output3:/output
    command: python align_videos.py /output/20250907_173011_Alpha.mp4 /output/20250907_173011_Alpha.json /output/20250907_173011_Bravo.mp4 /output/20250907_173011_Bravo.json /output
